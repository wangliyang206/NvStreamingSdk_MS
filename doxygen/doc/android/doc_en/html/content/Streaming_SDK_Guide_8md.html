<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MeiCam SDK For Android: simple guide to Meishe streaming SDK</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MeiCam SDK For Android
   &#160;<span id="projectnumber">3.13.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">simple guide to Meishe streaming SDK </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>A simple guide to Meishe streaming SDK</h1>
<p>&emsp;&emsp;This is a very simple guide to Meishe streaming SDK aimed to help developers to understand the basic concepts of video editing/capturing and visual effects Meishe SDK can handle, We will also describe the basic steps to complete a common video editing/capturing task using Meishe streaming SDK.</p>
<p>&emsp;&emsp;Meishe streaming SDK is a versatile video/audio processing SDK to help users to build their video content creation applications, including video capturing, video editing, visual effect and more. It currently works under Android 4.1+ and iOS 8.0+ (We also have Windows and macOS version, but not released as a product). Meishe streaming SDK implements nearly the same API for both Android and iOS, they differ only in language, one in JAVA and one in objective-C. For video editing, Meishe streaming SDK uses an architecture which is much like NLE(non-linear video editing) system, user can create a timeline with any number of video track/video clips and can modify them at any time without any pre-process to the original media files. For video capturing, Meishe streaming SDK will handle all the dirty work for developers and let them concentrate on the content they are capturing.</p>
<p>&emsp;&emsp;This guide will first introduce the basic concept of video editing and steps to call the API; Then we will cover video capturing.</p>
<h2>1、Video editing</h2>
<p>&emsp;&emsp;To edit video and audio files by Meishe streaming SDK you must create a timeline to describe what to do with the media files. A timeline is a data structure to let developers tell the streaming engine how to process the media files. It is composed of any number of video tracks and audio tracks, each track can contain a sequence of video/audio clips. You can add video transition effects between two adjacent clips and can add unlimited video/audio filter effects in video/audio clip. Timeline video FX,animated sticker and caption can also be added in the timeline level.</p>
<p>&emsp;&emsp;The following graph demonstrate the structure of a timeline.</p>
<div class="image">
<img src="ad3448b6-3f44-ab33-17ed-434203f5c8e1.png" alt=""/>
<div class="caption">
Streaming Context</div></div>
   <p>&emsp;&emsp;One can create any number of timelines at a time. If you want to create a timeline you can do it with the following code snippet: </p><pre class="fragment">NvsStreamingContext streamingCtx = NvsStreamingContext.init(ctx, null, 0);
NvsVideoResolution videoEditRes = new NvsVideoResolution();
videoEditRes.imageWidth = 1280; 
videoEditRes.imageHeight = 720; 
videoEditRes.imagePAR = new NvsRational(1, 1); 
NvsRational videoFps = new NvsRational(30, 1); 
NvsAudioResolution audioEditRes = new NvsAudioResolution();
audioEditRes.sampleRate = 44100; 
audioEditRes.channelCount = 2;
NvsTimeline timeline = streamingCtx.createTimeline(videoEditRes, videoFps, audioEditRes);
</pre><p>&emsp;&emsp;First of all you must call NvsStreamingContext.init() to initialize the SDK before doing anything with Meishe streaming SDK. The above code creates a timeline with a video dimension of 1280x720, 30 frames per second and the audio sample rate of 44100 and 2 audio channels. The created timeline object will be returned in NvsStreamingContext.createTimeline().</p>
<p>&emsp;&emsp;Suppose that you have two video files: /tmp/video1.mp4（duration:10 seconds）and /tmp/video2（duration:5 seconds）,you want to add both video files to the timeline and edit them. You can do it as follows:</p>
<pre class="fragment">NvsVideoTrack videoTrack = timeline.appendVideoTrack();
NvsVideoClip videoClip1 = videoTrack.appendClip(“/tmp/video1.mp4”);
NvsVideoClip videoClip2 = videoTrack.appendClip(“/tmp/video2.mp4”);
</pre><p>&emsp;&emsp;NOTE: you must create at least one video track in the timeline to hold video clips since timeline can only hold tracks and clips are held in tracks. Now you have added two video clips with the specified media file path in the only video track of the timeline. The first video clip will occupy [0,10s) time interval in the video track and second will occupy [10,15). Now you want to preview the content in the timeline(i.e. the two video clips) then you can do it as follows:</p>
<pre class="fragment">streamingCtx.connectTimelineWithLiveWindow(timeline, liveWindow);
streamingCtx.playbackTimeline(timeline, 0, -1, NvsStreamingContext.VIDEO_PREVIEW_SIZEMODE_LIVEWINDOW_SIZE, true, 0);
</pre><p>&emsp;&emsp;NOTE: liveWindow here indicates a created view object of type NvsLiveWindow, it is used to display the timeline output frame. Before using it you must call NvsStreamingContext.connectTimelineWithLiveWindow() to connect a timeline with the live window. After calling NvsStreamingContext.playbackTimeline() the video files in the timeline will be played back and the output video frame will be presented in the live window.</p>
<p>&emsp;&emsp;Now suppose you don’t like some contents of the two video files, you just want the first 4 seconds of the first video file and the last 2 seconds of the second video file, then you do it as follows: </p><pre class="fragment">videoClip1.changeTrimOutPoint(4000000, true);
videoClip2.changeTrimInPoint(3000000, true);
</pre><p>&emsp;&emsp;Now you have done it, if you play back the timeline again you will the observe the change you have made. Note that the above code will finish instantly and will not modify the original physical video file, it just tells the timeline you want to crop the video file and all the work will be done in real-time when you play back the timeline.</p>
<p>&emsp;&emsp;Now let me give you a brief introduction of what the function really does. First of all every clip has a trim in and a trim out point, it indicates which part of the media file you want to process in the timeline. For example, when you append /tmp/video1.mp4 at first, its trim in point will be 0, and trim out point will be 10000000 which means you will use the whole file(Please keep that in mind that all the time value used in Meishe streaming SDK will be in microsecond). videoClip1.changeTrimOutPoint(4000000, true); simply changes the trim out point of the first video clip to 4s which means the last 6s is cut out. The second parameter is set to true means the subsequent clips will be moved forward according to this change, if you set the second parameter to false it will leave a 6s hole between the first clip and the second. Then videoClip2.changeTrimInPoint(3000000, true); simply cuts the first 3s of the first video file.</p>
<p>&emsp;&emsp;Note that there are many more operations you can do to edit the video/audio clips in the timeline but since this is a simple guide, we will not discuss them here.</p>
<p>&emsp;&emsp;Say that you have completed your video editing and you want to generate a final video of the timeline, you can do this by: </p><pre class="fragment">streamingCtx.compileTimeline(timeline, 0, timeline.getDuration(), “/tmp/output.mp4”, NvsStreamingContext.COMPILE_VIDEO_RESOLUTION_GRADE_720, NvsStreamingContext.COMPILE_BITRATE_GRADE_HIGH, 0);
</pre><p>&emsp;&emsp;By calling compileTimeline() the streaming engine starts to compile the final result of the timeline into a video file specified by you(in this example, /tmp/output.mp4). This call will return immediately after you call it, the compiling is being processed in the internal threads of the streaming engine. You must implement NvsStreamingContext.CompileCallback/NvsStreamingContext.CompileCallback2 interface to listen to the progress/failure/cancellation event of the compiling process.</p>
<p>&emsp;&emsp;Suppose that you want more fun with the video you have created, you decide to add a cartoon effect to the first video clip and a color correction to the whole timeline, you can do this as follows: </p><pre class="fragment">videoClip1.appendBuiltinFx(“Cartoon”);
NvsTimelineVideoFx lutFx = timline.addBuiltinTimelineVideoFx(0, timeline.getDuration(), “Lut”);
lutFx.setStringVal(“Data File Path, “/tmp/pink-3dlut.mslut”);
</pre><p>&emsp;&emsp;Now, the visual effects has been added, you can play back the timeline to see the change. There are many built-in visual effects in Meishe streaming SDK, each one has a set of parameters which you can use to tune the visual effect. Apart from built-in visual effect there are also packaged visual effect which is the real power of Meishe SDK, it gives you unlimited possibility and extensibility to visual effect. We also have custom video FX. But these beyond the scope of this guide.</p>
<p>&emsp;&emsp;Now you may want to add a caption to the timeline: </p><pre class="fragment">timline.addCaption(“Hello World!”, 1000000, 3000000, null);
</pre><p>&emsp;&emsp;A caption has been added to the timeline which start from 1s and last 3s. The last parameter of addCaption() indicate a caption style package which can give more visual impact on your caption, but we will not discuss it here.</p>
<p>&emsp;&emsp;You can also add transition effect between clips such as: </p><pre class="fragment">videoTrack.setBuiltinTransition(0, “Lens Flare”);
</pre><p>&emsp;&emsp;You will see a lens flare effect between the first video clip and the second one. There are also animated stickers but we don’t discuss it here.</p>
<p>&emsp;&emsp;You can also add audio clips to an audio track of the timeline, you edit audio clips the same way as you edit video clips. Note that the audio track in a video file will also form a audio track of the timeline but it is invisible to developers (but you can change its volume if you want). You can also add audio effects to audio clips.</p>
<p>&emsp;&emsp;The last thing I want to discuss is theme. A theme is package to beautify your timeline automatically. To apply a theme to a timeline you can do this: </p><pre class="fragment">timeline.applyTheme(themeId);
</pre><p>&emsp;&emsp;After this your timeline has been decorated by the given theme package. Every theme package has its own design, this is the fastest way to beautify your timeline. The theme package is among the several kinds of packaged materials of Meishe SDK provided.</p>
<p>&emsp;&emsp;Below is a graph to demonstrate the usage of timeline:</p>
<div class="image">
<img src="232b9f6d-2453-9d65-81b3-8ea71d50602.png" alt=""/>
<div class="caption">
Timeline</div></div>
   <h2>2、Video capturing</h2>
<p>&emsp;&emsp;Now let’s move to the topic of video capturing. Capture video with Meishe SDK is very easy, to start a camera preview simply do as the following: </p><pre class="fragment">streamingCtx.connectCapturePreviewWithLiveWindow(mLiveWindow);
streamingCtx.startCapturePreview(0, NvsStreamingContext.VIDEO_CAPTURE_RESOLUTION_GRADE_HIGH , NvsStreamingContext.STREAMING_ENGINE_CAPTURE_FLAG_DONT_USE_SYSTEM_RECORDER, null));
</pre><p>&emsp;&emsp;First, we connect capture preview with a live window object, then we call startCapturePreview() to start capture preview, the captured video frame will be presented in the live window view. The first parameter of startCapturePreview() is the capture device index,</p>
<p>&emsp;&emsp;Meishe streaming SDK provides API to query capture device count and facing of each capture device. The second parameter indicates the resolution level of the capture preview. In general NvsStreamingContext.VIDEO_CAPTURE_RESOLUTION_GRADE_HIGH will start a capture preview of 720P in dimension. You can also set some flags in the third parameters but we won’t discuss it here.</p>
<p>&emsp;&emsp;There are many operations to control how you can capture a video such as focus, auto exposure, exposure compensation..., but these are beyond the scope of this guide.</p>
<p>&emsp;&emsp;You may want to add a visual effect for video capturing, do it as follows: </p><pre class="fragment">NvsStreamingContext.appendBuiltinCaptureVideoFx(“Beauty”);
</pre><p>&emsp;&emsp;This will add a face beautification built-in effect to video capturing. Note that all the visual effects available for video editing also apply to video capturing. You can also add face related stickers to video capturing.</p>
<p>&emsp;&emsp;To record the captured video frames to a file:</p>
<pre class="fragment">streamingCtx.startRecording(“/tmp/record.mp4”);
</pre><p>&emsp;&emsp;This will start video recording and save video frames to the specified media file. You can call NvsStreamingContext.stopRecording() to finish video recording. You can call startRecording()/stopRecording() multiple times to record several video files. It is also possible to record several interval into a single media file.</p>
<p>&emsp;&emsp;Below is a graph to demonstrate video capturing:</p>
<div class="image">
<img src="712fa25d-d551-e0c4-80c9-7a6ac8c5fdf13.png" alt=""/>
<div class="caption">
Captrue video</div></div>
   <h2>3、Epilogue</h2>
<p>&emsp;&emsp;This is a very simple guide to Meishe streaming SDK. It can do much more than the functions described in this guide. Developers can take the sdk demo project as a starting point. There are also API documents in Meishe SDK website: <a href="https://www.meishesdk.com">https://www.meishesdk.com</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
